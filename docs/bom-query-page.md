# BOM查询页面使用说明

## 功能概述

BOM查询页面提供了物料BOM展开查询、物料信息展示和图纸预览功能。用户可以通过输入物料编码，查看该物料的完整BOM结构树，并查看每个子物料的详细信息和技术图纸。

## 页面访问

- **路由路径**: `/BomQuery`
- **菜单配置**: 需要在系统菜单管理中添加对应的菜单项
  - 菜单名称: BOM查询
  - URL: /BomQuery
  - 视图/表名: BomQuery

## 功能说明

### 1. 查询BOM

1. 在页面顶部的输入框中输入物料编码（例如：0402300341）
2. 点击"查询"按钮或按回车键
3. 系统将展示该物料的完整BOM树形结构

### 2. 查看BOM树

- **左侧区域**显示BOM树形结构
- 树节点格式：`物料编码 / 物料名称`
- 默认全部展开所有层级
- 点击树节点可切换查看不同物料的详细信息

### 3. 查看物料信息

- **右侧上方**显示当前选中物料的详细信息
- 包含以下字段：
  - 物料编码
  - 物料名称
  - 规格型号
  - 单位
  - 用量分子
  - 用量分母

### 4. 查看图纸

- **右侧下方**显示当前选中物料的技术图纸
- 支持PDF格式图纸在线预览
- 如果物料没有图纸，将显示"暂无图纸"提示

## 操作流程

```
1. 输入物料编码
   ↓
2. 点击查询按钮
   ↓
3. 左侧显示BOM树，右侧显示根节点物料信息和图纸
   ↓
4. 点击左侧树节点
   ↓
5. 右侧自动更新对应物料的信息和图纸
```

## 界面布局

```
┌─────────────────────────────────────────────────────────┐
│  BOM 组件                                                │
│  ┌──────────────────┐  ┌────────┐                       │
│  │ 物料编码 [输入框] │  │ 查询   │                       │
│  └──────────────────┘  └────────┘                       │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  ┌──────────────┐  ┌──────────────────────────────────┐│
│  │  BOM结构     │  │  物料信息                         ││
│  │              │  │  ┌────────────────────────────┐  ││
│  │  ├─ 物料1    │  │  │ 物料编码: xxx               │  ││
│  │  │  ├─ 子1   │  │  │ 物料名称: xxx               │  ││
│  │  │  └─ 子2   │  │  │ 规格型号: xxx               │  ││
│  │  └─ 物料2    │  │  │ ...                        │  ││
│  │              │  │  └────────────────────────────┘  ││
│  │              │  │                                   ││
│  │              │  │  图纸                             ││
│  │              │  │  ┌────────────────────────────┐  ││
│  │              │  │  │                             │  ││
│  │              │  │  │   [PDF预览区域]             │  ││
│  │              │  │  │                             │  ││
│  │              │  │  └────────────────────────────┘  ││
│  └──────────────┘  └──────────────────────────────────┘│
└─────────────────────────────────────────────────────────┘
```

## 技术特性

1. **自动展开**: 查询成功后自动展开所有BOM层级
2. **默认选中**: 自动选中根节点并显示其信息
3. **异步加载**: 图纸采用异步加载，不阻塞物料信息展示
4. **缓存机制**: 图纸文件缓存24小时，提高加载速度
5. **响应式布局**: 自适应不同屏幕尺寸

## 注意事项

1. 物料编码必须在ERP系统中存在
2. 物料必须有BOM数据才能展开
3. 图纸文件需要在图纸管理系统中存在
4. 首次加载图纸可能需要较长时间（下载并缓存）
5. 后续访问相同图纸将直接使用缓存

## 错误提示

- **"物料编码不能为空"**: 请输入物料编码后再查询
- **"未在ERP中找到该物料编码"**: 物料不存在，请检查编码是否正确
- **"未在ERP中找到该物料的BOM"**: 该物料没有BOM数据
- **"BOM展开结果为空"**: BOM展开失败，请联系管理员
- **"暂无图纸"**: 该物料没有关联的技术图纸

## 后端接口

页面调用以下3个后端接口：

1. **BOM展开接口**
   - URL: `GET /api/BomQuery/ExpandBom?materialNumber={物料编码}`
   - 功能: 查询物料的BOM展开结果

2. **物料查询接口**
   - URL: `GET /api/BomQuery/GetMaterial?materialCode={物料编码}`
   - 功能: 查询物料基本信息（当前未使用，物料信息直接从BOM数据中获取）

3. **图纸查询接口**
   - URL: `GET /api/BomQuery/GetDrawing?materialCode={物料编码}`
   - 功能: 查询物料的图纸预览URL

## 开发信息

- **前端文件**: `web.vite/src/views/order/ordercollaboration/BomQuery.vue`
- **后端控制器**: `api/HDPro.WebApi/Controllers/Order/BomQueryController.cs`
- **路由配置**: `web.vite/src/router/viewGird.js`
- **开发日期**: 2025-11-15

